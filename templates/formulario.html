<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='image/fav.png') }}" type="image/png">
    <title>TimbuMuscle</title>
</head>
<body>
    <header class="nav">
        <nav>
           <div class="nav-esquerda">
                <h1>TimbuMuscle</h1>
                <a href="{{ url_for('usuarios.usuarios', key=key) }}">HOME</a>
                <a href="{{ url_for('usuarios.mostrar_treinos', key=key) }}">TREINOS</a>
                <a href="{{ url_for('suporte.suporte', key=key) }}">SUPORTE</a>
                
            </div>
            <div class="nav-direita-normal">
                <a href="{{ url_for('usuarios.perfil', key=key) }}">PERFIL</a>
            </div>
        </nav>
    </header>

    <main class="nav">
        <div class="form-container-treino">
            <div class="progress-bar">
                <div class="progress" id="progress"></div>
                <span id="progress-text">0%</span>
            </div>

            <form action="{{ url_for('usuarios.usuarios', key=key, user=user) }}" method="POST" id="multiStepForm">
                <div class="form-step active">
                    <h2>1. Qual √© o seu principal objetivo com o treino?</h2>
                    <div class="radio-options">
                        <div class="radio-option">
                            <label><input type="radio" name="objetivo" value="massa"> Ganho de massa muscular</label>
                        </div>

                        <div class="radio-option">
                            <label><input type="radio" name="objetivo" value="definicao"> Defini√ß√£o corporal / perder gordura</label>
                        </div>

                        <div class="radio-option">
                            <label><input type="radio" name="objetivo" value="saude"> Melhorar a sa√∫de e disposi√ß√£o</label>
                        </div>

                        <div class="radio-option">
                            <label><input type="radio" name="objetivo" value="forca"> Ganhar for√ßa</label>
                        </div>

                        <div class="radio-option">
                            <label><input type="radio" name="objetivo" value="estetico"> Ficar com o shape bonito / est√©tico</label>
                        </div>
                    </div>
                    <button type="button" class="next-btn">Pr√≥ximo</button>
                </div>

                <div class="form-step">

                    <h2>2. Qual √© o seu n√≠vel atual de treino com muscula√ß√£o?</h2>

                    <div class="radio-options">
                        <div class="radio-option">
                            <label><input type="radio" name="nivel" value="iniciante"> Iniciante (menos de 6 meses)</label>
                        </div>

                        <div class="radio-option">
                            <label><input type="radio" name="nivel" value="intermediario"> Intermedi√°rio (6 meses a 2 anos)</label>
                        </div>

                        <div class="radio-option">
                            <label><input type="radio" name="nivel" value="avancado"> Avan√ßado (mais de 2 anos)</label>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button type="button" class="prev-btn">Voltar</button>
                        <button type="button" class="next-btn">Pr√≥ximo</button>
                    </div>
                    
                </div>

                <div class="form-step">

                    <h2>3. Quantos dias por semana voc√™ pode treinar?</h2>

                    {% for i in range(3, 7) %}
                    <div class="radio-options">
                        <div class="radio-option">
                            <label><input type="radio" name="frequencia" value="{{ i }}"> {{ i }}</label>
                        </div>
                    </div>
                    {% endfor %}

                    <div class="btn-group">
                        <button type="button" class="prev-btn">Voltar</button>
                        <button type="button" class="next-btn">Pr√≥ximo</button>
                    </div>
        
                </div>
                
                <div class="form-step">

                    <h2>4. Quanto tempo voc√™ tem dispon√≠vel por treino?</h2>

                    <div class="radio-options">
                        <div class="radio-option">
                            <label><input type="radio" name="tempo" value="30"> 30 minutos</label>
                        </div>

                        <div class="radio-option">
                            <label><input type="radio" name="tempo" value="45"> 45 minutos</label>
                        </div>
                        
                        <div class="radio-option">
                            <label><input type="radio" name="tempo" value="60"> 1 hora</label>
                        </div>

                        <div class="radio-option">
                            <label><input type="radio" name="tempo" value="mais"> Mais de 1 hora</label>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button type="button" class="prev-btn">Voltar</button>
                        <button type="button" class="next-btn">Pr√≥ximo</button>
                    </div>

                </div>

                <div class="form-step">

                    <h2>5. Onde voc√™ pretende treinar?</h2>

                    <div class="radio-options">
                        <div class="radio-option">
                            <label><input type="radio" name="local" value="academia"> Academia</label>
                        </div>

                        <div class="radio-option">   
                            <label><input type="radio" name="local" value="casa_equip"> Em casa com equipamentos</label>
                        </div>

                        <div class="radio-option">
                            <label><input type="radio" name="local" value="casa_sem"> Em casa sem equipamentos</label>
                        </div>

                        <div class="radio-option">
                            <label><input type="radio" name="local" value="livre"> Ao ar livre</label>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button type="button" class="prev-btn">Voltar</button>
                        <button type="button" class="next-btn">Pr√≥ximo</button>
                    </div>
                </div>

                <div class="form-step">

                    <h2>6. Voc√™ tem alguma limita√ß√£o f√≠sica ou les√£o?</h2>

                    <div class="radio-options">
                        <div class="radio-option">
                            <label><input type="radio" name="lesao" value="nao"> N√£o</label>
                        </div>
                        
                        <div class="radio-option">
                        <label><input type="radio" name="lesao" value="sim"> Sim</label>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button type="button" class="prev-btn">Voltar</button>
                        <button type="button" class="next-btn">Pr√≥ximo</button>
                    </div>
                </div>

                <div class="form-step">

                    <h2>7. Voc√™ segue uma alimenta√ß√£o voltada para os objetivos?</h2>

                    <div class="radio-options">
                        <div class="radio-option">
                            <label><input type="radio" name="alimentacao" value="nutricionista"> Sim, com acompanhamento nutricional</label>
                        </div>
                        <div class="radio-option">
                            <label><input type="radio" name="alimentacao" value="propria"> Sim, por conta pr√≥pria</label>
                        </div>

                        <div class="radio-option">
                            <label><input type="radio" name="alimentacao" value="nao"> N√£o</label>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="prev-btn">Voltar</button>
                        <button type="button" class="next-btn">Pr√≥ximo</button>
                    </div>
                </div>

                <div class="form-step">

                    <h2>8. Como est√° seu percentual de gordura atual (se souber)?</h2>

                    <div class="radio-options">
                        <div class="radio-option">
                            <label><input type="radio" name="gordura" value="alto"> Alto</label>
                        </div>

                        <div class="radio-option">
                            <label><input type="radio" name="gordura" value="medio"> M√©dio</label>
                        </div>

                        <div class="radio-option">
                            <label><input type="radio" name="gordura" value="baixo"> Baixo</label>
                        </div>

                        <div class="radio-option">
                            <label><input type="radio" name="gordura" value="nao_sabe"> N√£o sei dizer</label>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="prev-btn">Voltar</button>
                        <button type="button" class="next-btn">Pr√≥ximo</button>
                    </div>
                </div>

                <div class="form-step"> 

                    <h2>9. N√≠vel de energia e motiva√ß√£o para treinar:</h2>

                    <div class="radio-options">
                        <div class="radio-option">
                            <label><input type="radio" name="motivacao" value="alta"> Alta motiva√ß√£o</label>
                        </div>

                        <div class="radio-option">
                            <label><input type="radio" name="motivacao" value="media"> Mediana</label>
                        </div>

                        <div class="radio-option">
                            <label><input type="radio" name="motivacao" value="baixa"> Baixa, preciso de est√≠mulo</label>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="prev-btn">Voltar</button>
                        <button type="button" class="next-btn">Pr√≥ximo</button>
                    </div>
                </div>

                <div class="form-step">

                    <h2>10. √Åreas do corpo que deseja focar:</h2>
                    
                    <div class="checkbox-options">
                        <div class="checkbox-option">
                            <input type="checkbox" id="peito" name="foco" value="peito">
                            <label for="peito">Peito</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="costas" name="foco" value="costas">
                            <label for="costas">Costas</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="pernas" name="foco" value="pernas">
                            <label for="pernas">Pernas</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="gluteos" name="foco" value="gluteos">
                            <label for="gluteos">Gl√∫teos</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="ombros" name="foco" value="ombros">
                            <label for="ombros">Ombros</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="abdomen" name="foco" value="abdomen">
                            <label for="abdomen">Abd√¥men</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="bracos" name="foco" value="bracos">
                            <label for="bracos">B√≠ceps / Tr√≠ceps</label>
                        </div>
                        <div class="checkbox-option">
                            <input type="checkbox" id="geral" name="foco" value="geral">
                            <label for="geral">Corpo todo</label>
                        </div>
                    </div>
                    
                    <div class="btn-group">
                        <button type="button" class="prev-btn">Voltar</button>
                        <button type="submit">Enviar</button>
                    </div>
                </div>
            </form>
        </div>
    </main>

    <script>
        const steps = document.querySelectorAll(".form-step");
        const progress = document.getElementById("progress");
        const progressText = document.getElementById("progress-text");
        const nextBtns = document.querySelectorAll(".next-btn");
        const prevBtns = document.querySelectorAll(".prev-btn");

        let currentStep = 0;

        function updateFormSteps() {
            steps.forEach((step, i) => {
                step.classList.toggle("active", i === currentStep);
            });
            let percent = ((currentStep + 1) / steps.length) * 100;
            progress.style.width = percent + "%";
            progressText.textContent = Math.round(percent) + "%";
        }

        nextBtns.forEach(btn => {
            btn.addEventListener("click", () => {
                if (!isStepValid()) {
                    alert("Por favor, selecione uma op√ß√£o para continuar.");
                    return;
                }
                if (currentStep < steps.length - 1) {
                    currentStep++;
                    updateFormSteps();
                }
            });
        })

        prevBtns.forEach(btn => {
            btn.addEventListener("click", () => {
                if (currentStep > 0) {
                    currentStep--;
                    updateFormSteps();
                }
            });
        });

        function isStepValid() {
            const inputs = steps[currentStep].querySelectorAll('input');
            const required = [...inputs].some(input => {
                if (input.type === 'radio' || input.type === 'checkbox') {
                    return input.checked;
                }
                if (input.type === 'text') {
                    return input.value.trim() !== "";
                }
            });
            return required;
        }


        updateFormSteps();
        
            document.getElementById('multiStepForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Coletar todos os dados do formul√°rio
            const formData = new FormData(this);
            
            // Validar campos obrigat√≥rios
            const camposObrigatorios = ['objetivo', 'nivel', 'frequencia', 'tempo', 'local', 'lesao', 'alimentacao', 'gordura', 'motivacao'];
            const dadosFaltantes = [];
            
            camposObrigatorios.forEach(campo => {
                if (!formData.get(campo)) {
                    dadosFaltantes.push(campo);
                }
            });
            
            if (dadosFaltantes.length > 0) {
                alert(`Por favor, preencha todos os campos obrigat√≥rios. Faltando: ${dadosFaltantes.join(', ')}`);
                return;
            }
            
            const data = {
                key: '{{ key }}',
                objetivo: formData.get('objetivo'),
                nivel: formData.get('nivel'),
                frequencia: formData.get('frequencia'),
                tempo: formData.get('tempo'),
                local: formData.get('local'),
                lesao: formData.get('lesao'),
                alimentacao: formData.get('alimentacao'),
                gordura: formData.get('gordura'),
                motivacao: formData.get('motivacao'),
                foco: Array.from(formData.getAll('foco'))
            };
            
            console.log('Dados enviados:', data); // Para debug
            
            // Mostrar loading
            const submitBtn = this.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.innerHTML = 'üß† Gerando Treinos...';
            
            fetch('/api/salvar-formulario', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    alert('‚úÖ ' + result.message);
                    window.location.href = result.redirect_url;
                } else {
                    alert('‚ùå Erro: ' + result.message);
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = 'Enviar';
                }
            })
            .catch(error => {
                alert('‚ùå Erro de conex√£o: ' + error.message);
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'Enviar';
            });
        });

    </script>
</body>
</html>
